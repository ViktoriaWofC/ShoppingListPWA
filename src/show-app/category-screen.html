<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../../bower_components/app-route/app-location.html">
<link rel="import" href="../../bower_components/app-route/app-route.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/iron-list/iron-list.html">
<link rel="import" href="../../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html"/>
<link rel="import" href="../../bower_components/paper-item/paper-item.html"/>
<link rel="import" href="../../bower_components/paper-checkbox/paper-checkbox.html"/>


<dom-module id="category-screen">
  <template>
    <style>
      :host {
        display: block;
      }
	  
	  #head {
		display: block;
        background-color: rgba(205, 255, 173, 1);
		height:30px;
		weight: 100px;
		text-align:center;
		line-height: 20px;
		color:black;
		padding-top:10px;
		margin-bottom:2px;
      }
	  
	  #inp{
		display: block;
        <!--background-color: rgba(205, 255, 173, 1);-->
		background-color:white;
		height:200px;
		width: 200px;
		text-align:center;
		color:black;
		padding:10px;
		margin: 0 auto;
	  }
	  
	  .block1 { 
		width: 800px; 
		height: 100px;
		background: rgba(205, 255, 173, 1);
		padding: 5px;
		padding-right: 20px; 
		padding-bottom: 30px;
		border: solid 1px black; 
		float: left;
	   }
	   
	   .blockHelp { 
		background: rgba(205, 255, 173, 1);
		border: solid 1px black; 
	   }
	   
	   .prokrutka {
		height:150px; /* высота нашего блока */
		background: #fff; /* цвет фона, белый */
		border: 1px solid #C1C1C1; /* размер и цвет границы блока */
		overflow-x: scroll; /* прокрутка по горизонтали */
		overflow-y: scroll; /* прокрутка по вертикали */
		}
	  
    </style>
	
	<app-location route="{{route}}"></app-location>
    <app-route
        route="{{route}}"
        pattern="/:page"
        data="{{routeData}}"
        tail="{{subroute}}"></app-route>
	
	<div id="head">
		Список категорий
	</div>	
	
	<div class="prokrutka">
	  <paper-listbox>
                <template is='dom-repeat' items='{{ array }}'>
                    <!-- Create an individual task -->
                    <paper-item>
                         {{ item.name }}
                 
                    </paper-item>
                </template>
            </paper-listbox>	
	</div>			
	
	<br><br>
	<paper-button toggles raised class="green" on-tap="testAdd">test add value
		</paper-button><br>
		<paper-button toggles raised class="green" on-tap="testReq">test get db</paper-button>
	<div class="block1">
	Переменные:
	<br><br>	
	prop1 = "[[prop1]]"
	</div>
    
  </template>

  <script>  
  
  
    Polymer({

      is: 'category-screen',

      properties: {
        prop1: {
          type: String,
          value: 'show-app',
        },
		
		testItem: {
          type: String,
          value: function() {
            return "5";
          },
		  
        },
		
		shows: {
          type: Array,
          value:[
               { name: 'All'},
               { name: 'Polycasts'}
             ]
          
        },
      },
	  
	  ready: function() {
		this.array=[{name: "qwdsdwsd"},{name: "123123"}];
			this.updateTasks();
			//localStorage.clear();
		},


	  testReq: function(e){
	 console.log("Req");
	  

	  },
	  
	  testAdd: function(e){
		console.log("Add");
		
		
				
		
		
		var i = array.length-1;
		var j = this.shows.length-1;
			console.log(this.shows[j]);
			//console.log(array[i]);
			console.log(j);
			

	  },
	  
	  updateTasks: function() {
			// Очистка массива
		//this.splice('array', 0);
			
			// Start a new transaction
		var db = open.result;
		var tx = db.transaction("MyObjectStore", "readwrite");
		var store = tx.objectStore("MyObjectStore");
		var index = store.index("NameIndex");		
		
		index.openCursor().onsuccess = function(event) {
		var cursor = event.target.result;
		if(cursor) {
		  console.log("cursor: "+cursor.value.id +" "+cursor.value.name.first +" "+ cursor.value.name.last +" "+cursor.value.age);  
		var task = {
					name: cursor.value.name.first
				};
					arrayT.push(task);//
					//this.push('array', task);
		
		//array.push({name:cursor.value.name.first});
		  cursor.continue();
		} else {
		  console.log('Entries all displayed.');
		  array = [];
			for(i = 0; i< arrayT.length; i++){
					console.log("arrayT: "+arrayT[i].name);  
					var task = {
					name: arrayT[i].name
				};
				
					array.push(task); 
					//this.push('array', task);
					console.log("array "+array[array.length-1].name);  
				}		  
		}
	  };

				
		 
			
		},
		

	  
	  
    });
	
	
	
	var ind = 1;
	var arrayT = [];
	//array.push({name:ind+" t"});
		//this.shows.push({name:ind+" t"});
	
	//var indexedDB = window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB;
	//var IDBTransaction = window.IDBTransaction || window.webkitIDBTransaction || window.msIDBTransaction;
	
	//var open = indexedDB.open("MyDatabase", 1);
	//var open = indexedDB.open("Categiries", 1);
	
	var indexedDB = window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB || window.shimIndexedDB;

	// Open (or create) the database
	var open = indexedDB.open("Data3", 1);

	// Create the schema
	open.onupgradeneeded = function() {
		var db = open.result;
		var store = db.createObjectStore("MyObjectStore", {keyPath: "id"});
		//var index = store.createIndex("NameIndex", ["name.last", "name.first"]);
		var index = store.createIndex("NameIndex", "name.last");
		var index2 = store.createIndex("NameInd", "id");
	};

	open.onsuccess = function() {
		// Start a new transaction
		var db = open.result;
		var tx = db.transaction("MyObjectStore", "readwrite");
		var store = tx.objectStore("MyObjectStore");
		var index = store.index("NameIndex");
		var index2 = store.index("NameInd");

		// Add some data
		store.put({id: 12345, name: {first: "John", last: "Doe"}, age: 42});
		store.put({id: 67890, name: {first: "Bob", last: "Smith"}, age: 35});
		store.put({id: 67490, name: {first: "Bobyyyy", last: "Smith"}, age: 35});
		
		// Query the data
		var getJohn = store.get(12345);
		var getBob = index.get("Smith");
		//var getBob = index.get(["Smith", "Bob"]);
		var getI = index2.get(12345);

		getJohn.onsuccess = function() {
			console.log(getJohn.result.name.first);  // => "John"
		};

		getBob.onsuccess = function() {
			console.log(getBob.result.name.first+" "+getBob.result.name.last);   // => "Bob"
		};
		
		getI.onsuccess = function() {
			console.log(getI.result.name.first);   // => "Bob"
		};
		
		
		index.openCursor("Smith").onsuccess = function(event) {
		//console.log("cursor:");
		var cursor = event.target.result;
		if(cursor) {
		  //console.log(cursor.value.id +" "+cursor.value.name.first +" "+ cursor.value.name.last +" "+cursor.value.age);  
		arrayT.push({name:cursor.value.name.first});
		  cursor.continue();
		} else {
		  //console.log('Entries all displayed.');
		/*for(i = 0; i< array.length; i++){
					console.log(arrayT[i].name);  
				}	  */
		}
	  };

		
		
	}
	
	

	
  </script>
</dom-module>
